{"version":3,"sources":["../src/Location.jsx"],"names":[],"mappings":"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","file":"Location.js","sourcesContent":["'use strict';\n\nimport React from 'react';\nimport ReactDom from 'react-dom';\nimport Awesomplete from 'awesomplete';\nimport Promise from 'promise-polyfill';\nimport google from './vendor/google';\n\nconst NO_MATCHING = 'Unrecognised {{value}}, please check and re-enter.';\nconst DEFAULT_COUNTRY = 'US';\n\nvar compose = function () {\n  var fns = arguments;\n\n  return function (result) {\n    for (let i = fns.length - 1; i >= 0; i--) {\n      result = fns[i].call(this, result);\n    }\n    return result;\n  };\n};\n\nexport default class Location extends React.Component {\n\n  render() {\n    return <input type='text' {...this.props.inputProps} />;\n  }\n\n  componentWillMount() {\n    this._googlePredictions = [];\n    this._country = this.props.country || DEFAULT_COUNTRY;\n    this._noMatching = this.props.noMatching || NO_MATCHING;\n  }\n\n  componentDidMount() {\n    var input;\n    var config = {\n      minChars: 1,\n      keepListItems: false,\n      sort: function () { return 0; },\n      item: function (text, input) {\n        return Awesomplete.$.create('li', {\n          innerHTML: text.replace(\n            RegExp(Awesomplete.$.regExpEscape(input.trim()), 'gi'),\n            '<mark>$&</mark>'\n          ),\n          'aria-selected': 'false'\n        });\n      }\n    };\n\n    input = ReactDom.findDOMNode(this);\n    this._autocomplete = new Awesomplete(input, config);\n\n    input.addEventListener(\n      'awesomplete-selectcomplete',\n      this._handleAutocompleteSelect.bind(this)\n    );\n    input.addEventListener(\n      'keyup',\n      this._handleInputChange.bind(this)\n    );\n  }\n\n  updateCountry(country) {\n    this._country = country;\n  }\n\n  _handleInputChange(event) {\n    var value = this._getInputValue();\n    var updateAutocomplete = compose(\n      this._autocomplete.evaluate.bind(this._autocomplete),\n      (list) => this._autocomplete.list = list,\n      (list) => list.map((item) => item.description),\n      (results) => this._googlePredictions = results\n    );\n    var fail = compose(\n      updateAutocomplete,\n      (text) => [{ description: text }],\n      (text) => {\n        return this._noMatching.replace('{{value}}', text);\n      }\n    );\n    var navKeys = [38, 40, 13, 27];\n    var isItNavKey = navKeys.indexOf(event.keyCode) >= 0;\n\n    if (!isItNavKey) {\n      this._getPredictions(value).then(updateAutocomplete, fail);\n    }\n  }\n\n  _handleAutocompleteSelect() {\n    var value = this._getInputValue();\n    var find = (list) => {\n      let l = list.filter(item => item.description === value);\n\n      return l.length > 0 ? l[0] : false;\n    };\n    var validate = item => item && item.place_id ? item.place_id : false;\n    var getPlaceId = compose(validate, find);\n    var success = (location) => {\n      this.props.onLocationSet && this.props.onLocationSet({\n        description: value,\n        coords: {\n          lat: location.lat(),\n          lng: location.lng()\n        }\n      });\n    };\n\n    this._getCoordinates(getPlaceId(this._googlePredictions)).then(success);\n  }\n\n  _getInputValue() {\n    return ReactDom.findDOMNode(this).value;\n  }\n\n  _getPredictions(text) {\n    var service = (this.props.google || google).createAutocompleteService();\n    var isThereAnyText = !!text;\n\n    if (isThereAnyText) {\n      return new Promise((resolve, reject) => {\n        service.getPlacePredictions({\n          input: text,\n          componentRestrictions: { country: this._country },\n          types: ['(regions)']\n        }, (result) => {\n          if (result !== null) {\n            resolve(result);\n          } else {\n            reject(text);\n          }\n        });\n      });\n    }\n    return new Promise((resolve, reject) => {});\n  }\n\n  _getCoordinates(placeId) {\n    var geocoder = (this.props.google || google).createGeocoder();\n\n    return new Promise((resolve, reject) => {\n      geocoder.geocode({ placeId: placeId }, (results, status) => {\n        if (status === 'OK' && results && results.length > 0) {\n          resolve(results[0].geometry.location);\n        } else {\n          reject(false);\n        }\n      });\n    });\n  }\n\n};\n\nLocation.defaultProps = {\n  className: '',\n  style: {}\n};\n\nLocation.propTypes = {\n  onLocationSet: React.PropTypes.func,\n  inputProps: React.PropTypes.object,\n  country: React.PropTypes.string,\n  noMatching: React.PropTypes.string,\n  google: React.PropTypes.object\n};\n"]}